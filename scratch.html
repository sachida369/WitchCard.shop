<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scratch to Reveal Your Girlfriendâ€™s Name</title>
  
  <!-- âœ… html2canvas for screenshot capturing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      background-color: #0e0420;
      height: 100vh;
      color: #ffd700;
    }

    .main-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      margin: auto;
      width: 350px;
      position: relative;
    }

    .witch-img {
      width: 100%;
      border-radius: 15px;
    }

    #scratch-container {
      position: absolute;
      top: 46.5%;
    }

    canvas {
      border-radius: 10px;
      width: 150px;
      height: 90px;
      cursor: pointer;
      box-shadow: 0 0 10px #000;
      opacity: 1;
      transition: opacity 1s ease;
    }

    .reward {
      width: 150px;
      height: 80px;
      display: none;
      color: #00ffcc;
      font-weight: bold;
      text-shadow: 1px 1px 2px black;
      opacity: 0;
      transition: opacity 1s ease;
    }

    .show-reward {
      display: block !important;
      opacity: 1 !important;
    }

    /* Share Button Styling */
    .share-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 0 5px #000;
    }

    @media only screen and (max-width: 768px) {
      .main-container {
        width: auto;
      }
    }
  </style>
</head>

<body>
  <div class="main-container">
    <div id="scratch-container">
      <div class="reward" id="reward">ðŸ’˜ Your future girlfriendâ€™s name is PRIYA!</div>
      <canvas id="canvas" width="210" height="100"></canvas>
    </div>
    <img src="witch-globe.png" alt="Witch Fortune Teller" class="witch-img">

    <!-- âœ… Share Button -->
    <button class="share-btn" onclick="sharePage()">ðŸ“¤ Share</button>
  </div>

  <script>
    // Scratch card logic
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const reward = document.getElementById('reward');
    let isDrawing = false;

    ctx.fillStyle = '#C0C0C0';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    canvas.addEventListener('mousedown', () => isDrawing = true);
    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mousemove', scratch);
    canvas.addEventListener('touchstart', () => isDrawing = true);
    canvas.addEventListener('touchend', () => isDrawing = false);
    canvas.addEventListener('touchmove', scratch);

    function scratch(e) {
      if (!isDrawing && !e.touches) return;

      const rect = canvas.getBoundingClientRect();
      const x = e.touches ? e.touches[0].clientX - rect.left : e.clientX - rect.left;
      const y = e.touches ? e.touches[0].clientY - rect.top : e.clientY - rect.top;

      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, 20, 0, 2 * Math.PI);
      ctx.fill();

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      let clearPixels = 0;
      for (let i = 0; i < imageData.data.length; i += 4) {
        if (imageData.data[i + 3] === 0) clearPixels++;
      }

      const scratchedPercent = clearPixels / (canvas.width * canvas.height) * 100;

      if (scratchedPercent > 45) {
        canvas.style.opacity = '0';
        setTimeout(() => {
          canvas.style.display = 'none';
          reward.classList.add('show-reward');
        }, 1000);
      }
    }

    // âœ… Share page screenshot and link using Web Share API
    async function sharePage() {
      try {
        // Capture screenshot of the entire body
        const canvasShot = await html2canvas(document.body);
        const blob = await new Promise(resolve => canvasShot.toBlob(resolve, 'image/png'));

        const filesArray = [new File([blob], 'screenshot.png', { type: 'image/png' })];

        // Check if Web Share API with file support is available
        if (navigator.canShare && navigator.canShare({ files: filesArray })) {
          await navigator.share({
            title: document.title,
            text: 'Check this fun scratch card!',
            url: window.location.href,
            files: filesArray
          });
        } else {
          alert('Sharing is not supported on this device/browser.');
        }
      } catch (err) {
        console.error('Sharing failed:', err);
        alert('An error occurred while sharing.');
      }
    }
  </script>
  <script>
  let _reward = document.getElementById('reward');
  let girlsList = [];

  // âœ… Fetch girls.json and pick a random name
  async function loadRandomName() {
    try {
      const response = await fetch('girls.json');
      girlsList = await response.json();
      const randomName = girlsList[Math.floor(Math.random() * girlsList.length)];
      reward.innerHTML = `ðŸ’˜ Your future girlfriendâ€™s name is ${randomName}!`;
    } catch (err) {
      console.error("Failed to load names:", err);
      reward.innerHTML = "ðŸ’˜ Couldn't load name!";
    }
  }

  // âœ… Call it as soon as page loads
  loadRandomName();
</script>

</body>

</html>
